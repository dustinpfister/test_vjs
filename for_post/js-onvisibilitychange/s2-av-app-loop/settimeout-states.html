<html>
    <head>
        <title>App Loop Demo</title>
    </head>
    <body>
        <div id="disp" style="background:gray;margin:10px;padding:10px;text-align:center;"></div>
        <script>
// info text helper
var infoText = function(sm){
   return 'fps: ' + sm.fps + ', count: ' + sm.game.count;
};
// State Machine (sm) object
var sm = {
    fps: 0,
    secs: 0,
    lt: new Date(),
    game: {
        count: 0
    },
    titleDefault: document.title,
    currentState: 'visible',
    states: {
        hidden: {
            update: function (sm, state, secs) {
                sm.game.count += 1;
                // just update title text
                document.title = infoText(sm);
            }
        },
        visible: {
            update: function (sm, state, secs) {
                sm.game.count += 1;
                // update title text with default text
                document.title = sm.titleDefault;
                // update disp div with fps info
                var disp = document.querySelector('#disp');
                disp.innerText = infoText(sm);
            }
        }
    }
};
// update method
var update = function (sm) {
    var now = new Date();
    sm.secs = (now - sm.lt) / 1000;
    sm.fps = 1 / sm.secs;
    // update fps value
    sm.fps = sm.fps < 1 ? sm.fps.toFixed(2) : Math.floor(sm.fps);
    sm.lt = now;
    // call the update method for the current state
    var state = sm.states[sm.currentState];
    state.update(sm, state, sm.secs);
};
// on visibility change event can be used to switch current states
document.addEventListener("visibilitychange", function () {
    sm.currentState = 'visible';
    if (document.visibilityState === 'hidden') {
        sm.currentState = 'hidden';
    }
});
// app loop using setTimeout
var loop = function () {
    setTimeout(loop, 33);
    update(sm);
};
loop(); // call update for first time
        </script>
    </body>
</html>