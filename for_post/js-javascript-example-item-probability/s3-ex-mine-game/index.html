<html>
    <head>
        <title>Item Probability</title>
    </head>
    <body>
        <div id="out"></div>
        <input id="mine_manual" type="button" value="mine">
        <script src="../s1-item-class/item-class.js"></script>
        <script>
// ore items
var ORES = {
    oreJunk: [['copper', 0.75], ['iron', 1]],
    oreCommon: [['zink', 0.25], ['lead', 1]]
};
// create and return an itemClass object for the given map
// using itemClass.create
var getItemClassObj = function(mine){
    // creating a item classes object
    return itemClass.create({
       levelPer: (mine.level - 1) / (mine.maxLevel -1),
       levelPerRatio: 0.5,
       pool: mine.oreClasses
    });
};
// create a mine object
var createMine = function(){
    var mine = {
        level: 1,
        maxLevel: 10,
        oreCounts: {},
        oreClasses: [
            {desc: 'oreJunk', range: [1000, 1000], levelPer: 1},
            {desc: 'oreCommon', range: [250, 600], levelPer: 0}
        ],
        itemClassObj: null
    };
    Object.keys(ORES).forEach(function(oreClassKey){
       ORES[oreClassKey].forEach(function(oreArr){
           mine.oreCounts[oreArr[0]] = 0;
       });
    });
    mine.itemClassObj = getItemClassObj(mine);
    return mine;
};
// draw the state of a mine object
var draw = function(mine){
    var text = 'level: ' + mine.level + '/' + mine.maxLevel + ', ores: [ '
    text += Object.keys(mine.oreCounts).map(function(oreKey){
        return oreKey + ': ' + mine.oreCounts[oreKey] + ', '
    }).join('') + ' ]';
    document.getElementById('out').innerText = text;
};
// single stroke of a mine
var singleStrike = function(mine){
    var classObj = itemClass.getRandomItemClass(mine.itemClassObj),
    oreList = ORES[classObj.desc];
    var i = 0,
    len = oreList.length,
    roll = Math.random();
    while(i < len){
       var oreArr = oreList[i];
       if(roll < oreArr[1]){
           mine.oreCounts[oreArr[0]] += 1;
           break;
       }
       i += 1;
    }
    draw(mine);
};
// create mine, draw for first time, and event attachment
var mine = createMine();
draw(mine);
document.getElementById('mine_manual').addEventListener('click', function(e){
   singleStrike(mine);
});
        </script>
    </body>
</html>