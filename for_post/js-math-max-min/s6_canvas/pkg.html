<html>
    <head>
        <title>js min max canvas app</title>
    </head>
    <body>
        <div id="canvas-min-max"></div>
        <script>
var points=(function(){var api={};api.gen=function(count,width,height){count=count===undefined?10:count;width=width===undefined?160:width;height=height===undefined?120:height;var points=[];var i=0;while(i<count){points.push({x:Math.floor(Math.random()*width),y:Math.floor(Math.random()*height),heading:Math.random()*(Math.PI*2),pps:16+Math.round(64*Math.random())});i+=1;}return points;};var getAxisValues=function(points,axis){axis=axis===undefined?'x':axis;return points.map(function(obj){return obj[axis];});};api.getLorH=function(points,minMax){minMax=minMax===undefined?'min':minMax;return{x:Math[minMax].apply(null,getAxisValues(points,'x')),y:Math[minMax].apply(null,getAxisValues(points,'y'))}};api.getAxisRanges=function(points){var xValues=getAxisValues(points,'x'),yValues=getAxisValues(points,'y'),xLow=Math.min.apply(null,xValues),yLow=Math.min.apply(null,yValues);return{x:(Math.max.apply(null,xValues)-Math.abs(xLow)),y:(Math.max.apply(null,yValues)-Math.abs(yLow))}};var normalize=function(points,canvas){var range=api.getAxisRanges(points);canvas=canvas||{width:range.x,height:range.y};return points.map(function(pt){return{x:pt.x/canvas.width,y:pt.y/canvas.height}});};api.move=function(points,x,y,w,h,canvas){return normalize(points,canvas).map(function(pt){return{x:x+pt.x*w,y:y+pt.y*h};});};api.wrap=function(points,canvas){return points.map(function(pt){var x=pt.x,y=pt.y;x=x<0?canvas.width+x:x;y=y<0?canvas.height+y:y;x=x>=320?x%320:x;y=y>=240?y%240:y;return{x:x,y:y,heading:pt.heading,pps:pt.pps}});};return api;}());

var draw={};draw.background=function(ctx,canvas){ctx.fillStyle='black';ctx.fillRect(0,0,canvas.width,canvas.height);};draw.box=function(ctx,x,y,w,h,fill){ctx.fillStyle=fill||'black';ctx.fillRect(x,y,w,h);};draw.lowAndHigh=function(ctx,p){ctx.strokeStyle='white';var l=points.getLorH(p,'min'),h=points.getLorH(p,'max');ctx.beginPath();ctx.arc(l.x,l.y,3,0,Math.PI*2);ctx.stroke();ctx.beginPath();ctx.arc(h.x,h.y,9,0,Math.PI*2);ctx.stroke();}
draw.points=function(ctx,p,fill,radius){radius=radius||6;ctx.fillStyle=fill||'red';ctx.strokeStyle='black';var i=p.length,pt;while(i--){pt=p[i];ctx.beginPath();ctx.arc(pt.x,pt.y,radius,0,Math.PI*2);ctx.fill();ctx.stroke();}};

var container=document.getElementById('canvas-min-max'),canvas=document.createElement('canvas'),ctx=canvas.getContext('2d');container.appendChild(canvas);canvas.width=320;canvas.height=240;var state={points:points.gen(20,canvas.width,canvas.height),canvas:canvas,lt:new Date(),FPS:16,moved:{x:32,y:32,w:64,h:64,points:[]}};var update=function(state,secs){var i=0,len=state.points.length,pt;while(i<len){pt=state.points[i];pt.x+=Math.cos(pt.heading)*pt.pps*secs;pt.y+=Math.sin(pt.heading)*pt.pps*secs;i+=1;}
state.points=points.wrap(state.points,state.canvas);var m=state.moved;m.points=points.move(state.points,m.x,m.y,m.w,m.h,state.canvas);};var loop=function(){var now=new Date(),t=now-state.lt,secs=t/1000;requestAnimationFrame(loop);if(t>=1000/state.FPS){update(state,secs);var m=state.moved;draw.background(ctx,canvas);draw.points(ctx,state.points,' green ',6);draw.lowAndHigh(ctx,state.points);draw.box(ctx,m.x,m.y,m.w,m.h,' rgba(0, 0, 255, 0.4)')
draw.points(ctx,m.points,' blue ',3);draw.lowAndHigh(ctx,m.points);state.lt=now;}};loop();
		</script>
    </body>
</html>